<!doctype html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title><%= @u.name %>'s Kattis Progress</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <style>
    html {
      position: relative;
      min-height: 100%;
    }
    body {
      margin-bottom: 60px; /* Margin bottom by footer height */
    }
    .footer {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 60px; /* Set the fixed height of the footer here */
      line-height: 60px; /* Vertically center the text there */
      background-color: #f5f5f5;
    }

    .container {
      width: auto;
      max-width: 680px;
      padding: 0 15px;
    }
  </style>
</head>
<body>
  <main role="main" class="container">
    <h1 class="mt-5">Kattis Tracker</h1>
    <p class="lead"><%= @u.name %>'s Kattis Progress</p>

    <canvas id="myChart"></canvas><br>

    <table class="table table-sm">
      <thead>
        <th scope="col">Fetched at</th>
        <th scope="col">Rank</th>
        <th scope="col">Score</th>
      </thead>
      <tbody>
        <% @u.progress_entries.each do |progress| %>
          <tr>
            <td scope="row"><%= progress.created_at %></td>
            <td><%= progress.rank %></td>
            <td><%= progress.score %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <hr><br>
  </main>

  <footer class="footer">
    <div class="container">
      <span class="text-muted">See <a href="https://github.com/imjching/kmonitor">https://github.com/imjching/kmonitor</a> for more info. Feel free to suggest features! :)</span>
    </div>
  </footer>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.20.1/moment.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
  <script>
  var ctx = document.getElementById("myChart");
  var myChart = new Chart(ctx, {
    type: 'line',
    data: {
      datasets: [{
        data: [
          <% @u.progress_entries.each do |progress| %>
          { x: "<%= progress.updated_at.iso8601 %>", y: "<%= progress.score %>" },
          <% end %>
        ],
        lineTension: 0,
        backgroundColor: "transparent",
        borderColor: "#007bff",
        borderWidth: 4,
        pointBackgroundColor: "#007bff"
      }]
    },
    options: {
      scales: {
        xAxes: [{
          type: "time",
          time: {
            unit: "day",
            unitStepSize: 1,
            displayFormats: {
              "day": "MMM DD"
            }
          }
        }],
        yAxes: [{
          ticks: {
            beginAtZero: false
          }
        }]
      },
      legend: {
        display: false,
      }
    }
  });
</script>
</body>
</html>
